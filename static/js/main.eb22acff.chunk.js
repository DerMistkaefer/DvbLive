(this["webpackJsonpdvb-live-frontend"]=this["webpackJsonpdvb-live-frontend"]||[]).push([[0],{114:function(t,e,n){},115:function(t,e,n){},156:function(t,e,n){},160:function(t,e,n){"use strict";n.r(e);var o=n(3),i=n.n(o),r=n(36),a=n.n(r),c=n(166),s=n(169),u=(n(114),n.p+"static/media/logo.103b5fa1.svg"),l=(n(115),n(8)),p=n(24),d=n(15),b=n.n(d),f=(n(136),n(26)),h=n(1),j=n(0),v=n.n(j),m=n(57),O=n.n(m),g="https://dvb-live-backend.dermistkaefer.de";function y(){return x.apply(this,arguments)}function x(){return(x=Object(h.a)(v.a.mark((function t(){var e;return v.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,O.a.get("".concat(g,"/lines/all"));case 2:return e=t.sent,t.abrupt("return",e.data);case 4:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function k(){return P.apply(this,arguments)}function P(){return(P=Object(h.a)(v.a.mark((function t(){var e;return v.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,O.a.get("".concat(g,"/stops/all"));case 2:return e=t.sent,t.abrupt("return",e.data);case 4:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function w(){return S.apply(this,arguments)}function S(){return(S=Object(h.a)(v.a.mark((function t(){var e;return v.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,O.a.get("".concat(g,"/live/vehicle"));case 2:return e=t.sent,t.abrupt("return",e.data);case 4:case"end":return t.stop()}}),t)})))).apply(this,arguments)}var C=n(35),T=n(10),N=n(11),E=n(17),A=n(18),D=n(9),W=["move"],M={"top-right":{top:10,right:10,bottom:"auto",left:"auto"},"top-left":{top:10,left:10,bottom:"auto",right:"auto"},"bottom-right":{bottom:10,right:10,top:"auto",left:"auto"},"bottom-left":{bottom:10,left:10,top:"auto",right:"auto"}},I={position:"absolute",zIndex:10,boxShadow:"0px 1px 4px rgba(0, 0, 0, .3)",border:"1px solid rgba(0, 0, 0, 0.1)",right:50,backgroundColor:"#fff",opacity:.85,display:"flex",flexDirection:"row",alignItems:"baseline",padding:"3px 7px"},L=Object.keys(M),_=function(t){Object(E.a)(n,t);var e=Object(A.a)(n);function n(){var t;Object(T.a)(this,n);for(var o=arguments.length,i=new Array(o),r=0;r<o;r++)i[r]=arguments[r];return(t=e.call.apply(e,[this].concat(i))).state={longitude:0,latitude:0,zoom:0},t.setPosition=function(){var e=t.props.map;t.setState({longitude:+e.getCenter().lng.toFixed(4),latitude:+e.getCenter().lat.toFixed(4),zoom:+e.getZoom().toFixed(2)})},t}return Object(N.a)(n,[{key:"componentDidMount",value:function(){var t=this;this.setPosition(),W.forEach((function(e){t.props.map.on(e,t.setPosition)}))}},{key:"componentWillUnmount",value:function(){var t=this;this.props.map&&W.forEach((function(e){t.props.map.off(e,t.setPosition)}))}},{key:"render",value:function(){var t=this.props,e=t.style,n=t.position,o=t.className,i=t.tabIndex,r=this.state,a=r.longitude,c=r.latitude,s=r.zoom;return Object(D.jsxs)("div",{tabIndex:i,style:Object(C.a)(Object(C.a)(Object(C.a)({},I),M[n]),e),className:o,children:["Longitude: ",a," | Latitude: ",c," | Zoom: ",s]})}}]),n}(o.Component);_.defaultProps={position:L[1]};var V,Z=(V=_,function(t){return Object(D.jsx)(p.d.Consumer,{children:function(e){return Object(D.jsx)(V,Object(C.a)({map:e},t))}})}),G=(n(156),n(31)),F=function(){function t(){Object(T.a)(this,t),this.stopPoints={}}return Object(N.a)(t,[{key:"setStopPoints",value:function(t){var e=this;t.forEach((function(t){e.stopPoints[t.idStopPoint]=[t.longitude,t.latitude]}))}},{key:"getCurrentVehiclePositions",value:function(t){var e=this,n=Date.now(),o=Math.floor(n/1e3);return Object(G.a)(t).select((function(t){var i=e.getTripCurrentPosition(t,n,o);return{idTrip:t.idTrip,position:i}})).toArray()}},{key:"getTripCurrentPosition",value:function(e,n,o){var i=Object(G.a)(e.stops),r=i.lastOrDefault((function(t){return null!=t.departureTime&&t.departureTime<=o})),a=i.firstOrDefault((function(t){return null!=t.arrivalTime&&o<=t.arrivalTime}));if(null==a||null==r){if(null!=r)return this.GetStopPosition(r.idStopPoint);if(null!=a)return this.GetStopPosition(a.idStopPoint);throw new Error("Failed Cache")}var c=1e3*r.departureTime,s=1e3*a.arrivalTime,u=r.idStopPoint,l=a.idStopPoint,p=t.PercentageBetween(c,s,n);return this.GetCurrentPosition(u,l,p)}},{key:"GetCurrentPosition",value:function(e,n,o){var i=this.GetStopPosition(e),r=this.GetStopPosition(n);return[t.NumberWithPercentage(i[0],r[0],o),t.NumberWithPercentage(i[1],r[1],o)]}},{key:"GetStopPosition",value:function(t){return this.stopPoints[t]}}],[{key:"NumberWithPercentage",value:function(t,e,n){return(e-t)*n+t}},{key:"PercentageBetween",value:function(t,e,n){var o=(n-t)/(e-t);return isFinite(o)?o:0}}]),t}();function Q(t){return t.children(Object(f.useQuery)(t.keyName,t.fn,t.options))}var z=function(t){return function(e){return Object(D.jsx)(p.d.Consumer,{children:function(n){return Object(D.jsx)(t,Object(C.a)({map:n},e))}})}}(function(t){Object(E.a)(n,t);var e=Object(A.a)(n);function n(t){var o;return Object(T.a)(this,n),(o=e.call(this,t)).enable=!1,o.markerCache={},o.calculator=void 0,o.liveVehiclePositionData=[],o.framesPerSecond=24,o.calculator=new F,o}return Object(N.a)(n,[{key:"componentDidMount",value:function(){var t=this;this.enable=!0,requestAnimationFrame((function(e){return t.updateVehiclePosition(e)}))}},{key:"componentWillUnmount",value:function(){this.enable=!1}},{key:"render",value:function(){var t=this;return Object(D.jsxs)("div",{children:[Object(D.jsx)(Q,{keyName:"stopPoints",fn:k,children:function(e){var n=e.data;return void 0!==n&&t.calculator.setStopPoints(n),""}}),Object(D.jsx)(Q,{keyName:"liveVehiclePositions",fn:w,children:function(e){var n=e.data;return t.liveVehiclePositionData=void 0!==n?Object(G.a)(n).toArray():[],""}})]})}},{key:"updateVehiclePosition",value:function(t){var e=this,n=this.props.map,o=this.calculator.getCurrentVehiclePositions(this.liveVehiclePositionData);Object(G.a)(Object.keys(this.markerCache)).where((function(t){return!Object(G.a)(o).any((function(e){return e.idTrip===t}))})).toArray().forEach((function(t){return delete e.markerCache[t]})),o.forEach((function(t){var o=e.markerCache[t.idTrip];void 0===o&&(console.log("New Marker ".concat(t.idTrip)),o=new b.a.Marker,e.markerCache[t.idTrip]=o),o.setLngLat(t.position),o.addTo(n)})),this.enable&&setTimeout((function(){requestAnimationFrame((function(t){return e.updateVehiclePosition(t)}))}),1e3/this.framesPerSecond)}}]),n}(o.Component)),H=void 0;b.a.workerClass=n(157).default,b.a.accessToken="pk.eyJ1IjoiZGVybWlzdGthZWZlciIsImEiOiJja2swYWQ0NHAwZm16Mm9rMmE3M3k2Zjk3In0.p8sQOMjTL_muHCN36uY9iA";var B=Object(p.i)({accessToken:"pk.eyJ1IjoiZGVybWlzdGthZWZlciIsImEiOiJja2swYWQ0NHAwZm16Mm9rMmE3M3k2Zjk3In0.p8sQOMjTL_muHCN36uY9iA"}),J={color:"#3f618c",fontWeight:400},R={speed:.8},q=function(){var t=Object(o.useState)(13.738),e=Object(l.a)(t,2),n=e[0],i=e[1],r=Object(o.useState)(51.0497),a=Object(l.a)(r,2),c=a[0],s=a[1],u=Object(o.useState)(12),d=Object(l.a)(u,2),b=d[0],h=d[1],j=Object(o.useState)(void 0),v=Object(l.a)(j,2),m=v[0],O=v[1],g=Object(o.useState)(void 0),x=Object(l.a)(g,2),P=x[0],w=x[1],S=function(t){P&&(P.getCanvas().style.cursor=t)},C=function(t){O(t),i(t.longitude),s(t.latitude),h(14)},T=Object(f.useQuery)("stopPoints",k),N=Object(f.useQuery)("publicTransportLines",y),E=null;return null!=N.data&&(E={type:"FeatureCollection",features:Object(G.a)(N.data).select((function(t){return t.line})).toArray()}),Object(D.jsxs)(B,{className:"map-container",style:"mapbox://styles/mapbox/streets-v11",center:[n,c],zoom:[b],onDrag:function(){m&&O(void 0)},onStyleLoad:function(t){w(t)},flyToOptions:R,children:[Object(D.jsx)(Z,{}),Object(D.jsx)(p.h,{}),Object(D.jsx)(p.f,{}),Object(D.jsx)(p.g,{style:{marginBottom:"15px"}}),Object(D.jsx)(p.b,{data:E,lineLayout:{visibility:"visible"},linePaint:{"line-width":3,"line-color":"#00f8ff"}}),Object(D.jsx)(p.c,{type:"symbol",layout:{"icon-image":["get","network"]},children:null!=T.data&&T.data.map((function(t){return Object(D.jsx)(p.a,{onClick:C.bind(H,t),onMouseEnter:S.bind(H,"pointer"),onMouseLeave:S.bind(H,""),coordinates:[t.longitude,t.latitude],properties:{network:"bus"}},t.idStopPoint)}))}),m&&Object(D.jsx)(p.e,{coordinates:[m.longitude,m.latitude],style:J,children:m.stopPointName},m.idStopPoint),Object(D.jsx)(z,{})]})},U=n(95),Y=n(94),K=n(93),$=new f.QueryClient({defaultOptions:{queries:{cacheTime:864e5}}}),X=Object(Y.a)({storage:window.localStorage});function tt(){return Object(D.jsxs)("div",{className:"App",children:[Object(D.jsxs)("header",{className:"App-header",children:[Object(D.jsx)("img",{src:u,className:"App-logo",alt:"logo"}),Object(D.jsxs)("p",{children:["Edit ",Object(D.jsx)("code",{children:"src/App.tsx"})," and save to reload."]}),Object(D.jsx)("a",{className:"App-link",href:"https://reactjs.org",target:"_blank",rel:"noopener noreferrer",children:"Learn React"})]}),Object(D.jsx)(q,{})]})}Object(U.a)({queryClient:$,persistor:X});var et=function(){return Object(D.jsxs)(f.QueryClientProvider,{client:$,children:[Object(D.jsx)(tt,{}),Object(D.jsx)(K.ReactQueryDevtools,{initialIsOpen:!1})]})};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));c.a({dsn:"https://e560ecb7fbd44b6a91809cf7deadaa4e@o247191.ingest.sentry.io/5536424",release:"dvb-live-frontend@"+Object({NODE_ENV:"production",PUBLIC_URL:"/DvbLive",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}).npm_package_version,autoSessionTracking:!0,enabled:!0}),a.a.render(Object(D.jsx)(i.a.StrictMode,{children:Object(D.jsx)(s.a,{fallback:Object(D.jsx)("p",{children:"An error has occurred"}),showDialog:!0,children:Object(D.jsx)(et,{})})}),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(t){t.unregister()})).catch((function(t){console.error(t.message)}))}},[[160,1,2]]]);
//# sourceMappingURL=main.eb22acff.chunk.js.map